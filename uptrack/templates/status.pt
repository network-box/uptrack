<html lang="en" xmlns:tal="http://xml.zope.org/namespaces/tal"
                xmlns:metal="http://xml.zope.org/namespaces/metal"
                metal:use-macro="layout.macros['layout']">

  <tal:block metal:fill-slot="content">
    <script src="${request.static_url('uptrack:static/js/status.js')}"></script>
    <div class="row-fluid">
      <h4 class="text-center">${status} packages in ${distro}
        <tal:block tal:omit-tag="" tal:condition="page not in ('downstream', 'problems')">coming from ${upstream}</tal:block>
      </h4>
    </div>
    <div tal:repeat="i_pkg filter(lambda x: x[0]%2==0, enumerate(packages))" class="row-fluid">
      <tal:block tal:omit-tag="" tal:define="index i_pkg[0]">
      <div class="span5 offset1 uptrack_statusblock">
        <tal:block tal:omit-tag="" tal:define="pkg i_pkg[1]">
        <h4>${pkg.name}
          <tal:block tal:omit-tag="" tal:condition="request.user is not None and page in ('downstream', 'problems')">
            <button type="button" id="popover_button_${pkg.id}" class="btn btn-default uptrack_package_popover" data-toggle="popover" data-pkg="${pkg.id}">
              <span class="icon-cog"></span>
            </button>
            <div id="popover_content_${pkg.id}" style="display: none">
              <ul class="uptrack_package_popover_menu">
                <tal:block tal:omit-tag="" tal:condition="page == 'downstream'">
                  <li data-pkgid="${pkg.id}" data-action="nodownstream">Unmark as downstream</li>
                </tal:block>
                <tal:block tal:omit-tag="" tal:condition="page == 'problems'">
                  <li data-pkgid="${pkg.id}" data-action="downstream">Mark as downstream</li>
                </tal:block>
              </ul>
            </div>
          </tal:block>
        </h4>
        <table class="table table-bordered table-striped">
          <tbody>
            <tal:block tal:omit-tag="" tal:condition="page == 'problems'">
              <tr>
                <td>Upstream</td>
                <td>${pkg.upstream.name if pkg.upstream else '?'}</td>
              </tr>
            </tal:block>
            <tr>
              <td>Upstream&nbsp;EVR</td>
              <td>${pkg.upstream_evr if pkg.upstream_evr else '?'}</td>
            </tr>
            <tr>
              <td>Our&nbsp;EVR</td>
              <td>${pkg.evr}</td>
            </tr>
          </tbody>
        </table>
        </tal:block>
      </div>
      <div tal:condition="len(packages) > index+1" class="span5 uptrack_statusblock">
        <tal:block tal:omit-tag="" tal:define="pkg packages[index+1]">
        <h4>${pkg.name}
          <tal:block tal:omit-tag="" tal:condition="request.user is not None and page in ('downstream', 'problems')">
            <button type="button" id="popover_button_${pkg.id}" class="btn btn-default uptrack_package_popover" data-toggle="popover" data-pkg="${pkg.id}">
              <span class="icon-cog"></span>
            </button>
            <div id="popover_content_${pkg.id}" style="display: none">
              <ul class="uptrack_package_popover_menu">
                <tal:block tal:omit-tag="" tal:condition="page == 'downstream'">
                  <li data-pkgid="${pkg.id}" data-action="nodownstream">Unmark as downstream</li>
                </tal:block>
                <tal:block tal:omit-tag="" tal:condition="page == 'problems'">
                  <li data-pkgid="${pkg.id}" data-action="downstream">Mark as downstream</li>
                </tal:block>
              </ul>
            </div>
          </tal:block>
        </h4>
        <table class="table table-bordered table-striped">
          <tbody>
            <tal:block tal:omit-tag="" tal:condition="page == 'problems'">
              <tr>
                <td>Upstream</td>
                <td>${pkg.upstream.name if pkg.upstream else '?'}</td>
              </tr>
            </tal:block>
            <tr>
              <td>Upstream&nbsp;EVR</td>
              <td>${pkg.upstream_evr if pkg.upstream_evr else '?'}</td>
            </tr>
            <tr>
              <td>Our&nbsp;EVR</td>
              <td>${pkg.evr}</td>
            </tr>
          </tbody>
        </table>
        </tal:block>
      </div>
      </tal:block>
    </div>
    <script type="text/javascript">
      $(document).ready(function() {
          make_popovers(".uptrack_package_popover");
      });
    </script>
  </tal:block>
</html>
